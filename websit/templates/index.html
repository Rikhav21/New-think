<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hand Gesture Classification</title>
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/hands/hands.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils/camera_utils.js"></script>
    <style>
        body {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100vh;
            margin: 0;
            font-family: Arial, sans-serif;
        }
        video, canvas {
            border: 1px solid #ccc;
            border-radius: 10px;
            width: 640px;
            height: 480px;
        }
        h1 {
            margin-bottom: 20px;
        }
    </style>
</head>
<body>
    <h1>Hand Gesture Classification</h1>
    <img src="{{ url_for('video_feed') }}" width="800" height="600">
    <video id="input-video" autoplay></video>
    <canvas id="output-canvas"></canvas>
    <script>
        const videoElement = document.getElementById('input-video');
        const canvasElement = document.getElementById('output-canvas');
        const canvasCtx = canvasElement.getContext('2d');

        async function loadModel() {
            const model = await tf.loadGraphModel('/web_model/model.json');
            console.log("Model loaded successfully:", model);
            return model;
        }

        async function main() {
            const model = await loadModel();

            const hands = new Hands({
                locateFile: (file) => `https://cdn.jsdelivr.net/npm/@mediapipe/hands/${file}`
            });

            hands.setOptions({
                maxNumHands: 1,
                minDetectionConfidence: 0.5,
                minTrackingConfidence: 0.5,
            });

            hands.onResults((results) => {
                canvasCtx.save();
                canvasCtx.clearRect(0, 0, canvasElement.width, canvasElement.height);
                canvasCtx.drawImage(results.image, 0, 0, canvasElement.width, canvasElement.height);

                if (results.multiHandLandmarks) {
                    for (const landmarks of results.multiHandLandmarks) {
                        Hands.drawConnectors(canvasCtx, landmarks, Hands.HAND_CONNECTIONS, 
                            {color: '#00FF00', lineWidth: 5});
                        Hands.drawLandmarks(canvasCtx, landmarks, 
                            {color: '#FF0000', lineWidth: 2});
                    }
                }
                canvasCtx.restore();
            });

            const camera = new Camera(videoElement, {
                onFrame: async () => {
                    await hands.send({image: videoElement});
                },
                width: 640,
                height: 480,
            });

            camera.start();
        }

        main().catch(err => console.error("Error initializing app:", err));
    </script>
</body>
</html>
